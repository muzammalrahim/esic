
// @fileRef listing.js 
jQuery(document).ready(function($){if($("select.select2-active").length>0){$("select").select2();}
if($(".date_picker").length>0){$('.date_picker').datepicker({format:'yyyy-mm-dd'});}
if($("select.customSelect2").length>0){$('.customSelect2').select2();}
if($("select.isDynamic").length>0){$('.isDynamic').select2({tags:true});}
if($("js-example-basic-multiple").length>0){$(".js-example-basic-multiple").select2();}
if($(".action-button-sticky-bar").length>0){console.log('action-button-sticky-bar');var wrap=$(".action-button-sticky-bar");$(window).on("scroll",function(){var fromTop=$("body").scrollTop();$('.action-button-sticky-bar').toggleClass("show-stickybar",(fromTop>200));});}});$(function(){if($("textarea.tinymce-active").length>0){tinymce.init({selector:'textarea',height:100,max_height:200,theme_advanced_resizing:false,theme_advanced_resizing_use_cookie:false,menubar:false,browser_spellcheck:true,contextmenu:false,spellchecker_rpc_url:base_url+'assets/tinymce/js/tinymce/plugins/spellchecker/spellchecker.php',plugins:[' spellchecker advlist autolink lists link image charmap print preview anchor code','searchreplace visualblocks code fullscreen','insertdatetime media jbimages table contextmenu paste code'],toolbar:'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | jbimages | media | code',content_css:'//www.tinymce.com/css/codepen.min.css',relative_urls:false});}
$(".approval-modal").on("shown.bs.modal",function(e){var button=$(e.relatedTarget);var ButtonParent=button.parents("tr");if(ButtonParent.hasClass('row')){ButtonParent=ButtonParent;}else if(ButtonParent.hasClass('child')){ButtonParent=button.parents("tr").prev("tr");}
var ID=ButtonParent.attr("data-id");var Name=ButtonParent.find('td').eq(1).text();var modal=$(this);var Message='Are you sure you want to trash record of: <strong>'+Name+'</strong>';modal.find("input#hiddenUserID").val(ID);modal.find(".modal-body").find('p').html(Message);modal.find('.modal-header').find('h4').html('Trash <strong>'+Name+'</strong>');});$("#yesApprove").on("click",function(){var hiddenModalID=$(this).parents(".modal-content").find("#hiddenUserID").val();var postData={id:hiddenModalID,value:"trash"};$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/trash",data:postData,type:"POST",success:function(output){var data=output.trim().split("::");if(data[0].split(' ').join('')=='OK'){$(".approval-modal").modal('hide');oTable.fnDraw();}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}}});});$("#nodelete").on("click",function(){var hiddenModalUserID=$(this).parents(".modal-content").find("#hiddenUserID").val();var postData={id:hiddenModalUserID,value:"untrash"};$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/trash",data:postData,type:"POST",success:function(output){var data=output.trim().split("::");if(data[0].split(' ').join('') =='OK'){$('.approval-modal').modal('hide');oTable.fnDraw();}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}}});});$("#permanentDelete").on("click",function(){var hiddenModalUserID=$(this).parents(".modal-content").find("#hiddenUserID").val();var postData={id:hiddenModalUserID,value:"delete"};$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/delete",data:postData,type:"POST",success:function(output){var data=output.trim().split("::");if(data[0].split(' ').join('') =='OK'){$('.approval-modal').modal('hide');oTable.fnDraw();}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}}});});$(".logo-edit-modal").on("shown.bs.modal",function(e){var button=$(e.relatedTarget);var ButtonParent=button.parents("tr");if(ButtonParent.hasClass('row')){ButtonParent=ButtonParent;}else if(ButtonParent.hasClass('child')){ButtonParent=button.parents("tr").prev("tr");}
var ID=ButtonParent.attr("data-id");var name=ButtonParent.find('td').eq(1).text();var src=button.attr('src');var modal=$(this);modal.find("input#hiddenUserID").val(ID);modal.find("img#logo-show").attr('src',src);modal.find(".modal-body").find('p > strong').text(' "'+name+'"');});$(".image-edit-modal").on("shown.bs.modal",function(e){var button=$(e.relatedTarget);var ID=$("#hiddenListID").val();var type=button.attr('data-type');var src=button.attr('src');var modal=$(this);modal.find("input#hiddenID").val(ID);modal.find("img#image-show").attr('src',src);modal.find(".modal-header").find('h4 > span').text(' "'+type+'"');modal.find(".modal-footer").find('#updateImage').attr('data-type',type);});$(".publish-modal").on("shown.bs.modal",function(e){var button=$(e.relatedTarget);var ButtonParent=button.parents("tr");if(ButtonParent.hasClass('row')){ButtonParent=ButtonParent;}else if(ButtonParent.hasClass('child')){ButtonParent=button.parents("tr").prev("tr");}
var ID=ButtonParent.attr("data-id");var esicName=ButtonParent.find(".esicName").text();var currentPublishStatusID=ButtonParent.find(".Publish-Status").attr("data-PublishStatusID");console.log(currentPublishStatusID);var modal=$(this);modal.find("input#hiddenUserID").val(ID);var publishText='Publish';if(currentPublishStatusID==1){publishText='UnPublish';}
$("#publishStatusID").val(currentPublishStatusID);$("#EsicNameTextBox").text(esicName);$("#publishStatusTextBox").text(publishText);});$("#update-logo-file").change(function(){readURL(this,'#logo-show');});$("#update-image-file").change(function(){readURL(this,'#image-show');});$("#product-file").change(function(){readURL(this,'#product-show');});$("#banner-file").change(function(){readURL(this,'#banner-show');});$("body #Logo-file").change(function(){console.log(this);readURL(this,'body #Logo-show');});$("#update-logo-file").change(function(){readURL(this,'#logo-show');});$("#updateLogo").on("click",function(){var hiddenModalID=$(this).parents(".modal-content").find("#hiddenUserID").val();var input=$(this).parents(".modal-content").find("#update-logo-file")[0];if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(e){var formData=new FormData();formData.append('logo',input.files[0]);formData.append('id',hiddenModalID);$.ajax({crossOrigin:true,type:'POST',url:baseUrl+"admin/"+ControllerRouteManage+"/updateLogo",data:formData,processData:false,contentType:false}).done(function(response){var data=response.trim().split("::");if(data[0].split(' ').join('') =='OK'){$(".logo-edit-modal").modal('hide');oTable.fnDraw();}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}});};reader.readAsDataURL(input.files[0]);}});$("#updateImage").on("click",function(){var hiddenModalID=$(this).parents(".modal-content").find("#hiddenID").val();var hiddenTypeImage=$(this).parents(".modal-content").find("#hiddenTypeImage").val();var input=$(this).parents(".modal-content").find("#update-image-file")[0];if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(e){var formData=new FormData();formData.append('image',input.files[0]);formData.append('id',hiddenModalID);formData.append('type',hiddenTypeImage);$.ajax({crossOrigin:true,type:'POST',url:baseUrl+"admin/"+ControllerRouteManage+"/updateImage",data:formData,processData:false,contentType:false}).done(function(response){var data=response.trim().split("::");if(data[0].split(' ').join('') =='OK'){$(".image-edit-modal").modal('hide');oTable.fnDraw();}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}});};reader.readAsDataURL(input.files[0]);}});$("#yesPublish").on("click",function(){var hiddenModalUserID=$(this).parents(".modal-content").find("#hiddenUserID").val();var publishStatusID=$(this).parents(".modal-content").find("#publishStatusID").val();if(hiddenModalUserID==''){hiddenModalUserID=$(this).attr('data-id');}
var actionToPerform="publish";if(publishStatusID==1){actionToPerform="unpublish";}
var postData={id:hiddenModalUserID,actionPerform:actionToPerform,currentValue:publishStatusID};$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/PublishAction",data:postData,type:"POST",success:function(output){console.log(output);var data=output.split("::");if(data[0].split(' ').join('') =='OK'){oTable.fnDraw();$('.publish-modal').modal('hide');}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}}});});$(".preview-button").click(function(event){event.preventDefault();var PreviewForm=$(this).parents('form');var formData=PreviewForm.serialize();var logo=getbase64Image(PreviewForm.find('input[type=file]#Logo-file'));var banner=getbase64Image(PreviewForm.find('input[type=file]#banner-file'));console.log(logo);console.log(banner);$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/PreviewContent",data:formData,type:"GET",success:function(output){var data=output.split("::");if(data[0].split(' ').join('') =='OK'){oTable.fnDraw();$('.publish-modal').modal('hide');}
if(data[3]){Haider.notification(data[1],data[2],data[3]);}else{Haider.notification(data[1],data[2]);}}});});var count=0;var withHeaders=true;var width=window.innerWidth*1;var height=width*window.innerHeight/window.innerWidth;var win;$("#previewSubmit").click(function(event){event.preventDefault();var PreviewForm=$(this).parents('form');formPreviewSubmit();var formData=PreviewForm.serializeArray();var obFormData=new FormData();$.each(formData,function(index,data){obFormData.append(data.name,data.value);});if($('#Logo-file')[0].files[0]==undefined){var logoUrl=$('#Logo-show').attr('src');obFormData.append('logo',logoUrl);}else{obFormData.append('logo',$('#Logo-file')[0].files[0]);}
if($('#banner-file')[0].files[0]==undefined){var logoUrl=$('#banner-show').attr('src');obFormData.append('banner',logoUrl);}else{obFormData.append('banner',$('#banner-file')[0].files[0]);}
obFormData.append('withHeaders',true);withHeaders=true;if($('#desc-content').length>0){obFormData.append('desc-content',$('#desc-content').val());}
obFormData.append('showPreview',true);obFormData.append('PreviewBackEnd',true);count++;$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/PreviewSubmitContent",data:obFormData,processData:false,contentType:false,type:"post",success:function(output){if(count>1){win.close();}
win=window.open('','newwindow','width='+width+', height='+height+', top='+((window.innerHeight-height)/2)+', left='+((window.innerWidth-width)/2));if(withHeaders==false){win.document.body.innerHTML=output;}else{win.document.write(output);}
win.focus();}});});$("#previewSubmitWOPB").click(function(event){event.preventDefault();var PreviewForm=$(this).parents('form');var formData=PreviewForm.serializeArray();var obFormData=new FormData();$.each(formData,function(index,data){obFormData.append(data.name,data.value);});if($('#Logo-file')[0].files[0]==undefined){var logoUrl=$('#Logo-show').attr('src');obFormData.append('logo',logoUrl);}else{obFormData.append('logo',$('#Logo-file')[0].files[0]);}
if($('#banner-file')[0].files[0]==undefined){var logoUrl=$('#banner-show').attr('src');obFormData.append('banner',logoUrl);}else{obFormData.append('banner',$('#banner-file')[0].files[0]);}
if(count==0){obFormData.append('withHeaders',true);withHeaders=true;}else{obFormData.append('withHeaders',false);withHeaders=false;}
count++;$.ajax({url:baseUrl+"admin/"+ControllerRouteManage+"/PreviewSubmitContentWOPB",data:obFormData,processData:false,contentType:false,type:"post",success:function(output){win=window.open('','newwindow','width='+width+', height='+height+', top='+((window.innerHeight-height)/2)+', left='+((window.innerWidth-width)/2));if(withHeaders==false){win.document.body.innerHTML=output;}else{win.document.write(output);}
win.focus();}});});$('input').change(function(event){var id=$(this).attr('id');var Parentid=$(this).attr('name');id='.'+id+'_s';Parentid='.'+Parentid+'_s';$(Parentid).hide();$(id).show();});$('input[type="checkbox"]').on('change',function(){if($(this).is(':checked')){$(this).attr('checked',true);}else{$(this).attr('checked',false);}});$('#saveQuestionnaire').click(function(event){event.preventDefault();var userID=$('input[name="userID"]').val();var listingID=$('input[name="listingID"]').val();saveQuestionnaire(userID,listingID);});});function readURL(input,selector){if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(e){$(selector).attr('src',e.target.result);}
reader.readAsDataURL(input.files[0]);}}
function readBackgroudURL(input,selector){if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(e){$(selector).css('background-image','url('+e.target.result+')');}
reader.readAsDataURL(input.files[0]);}}
function getbase64Image(input){var returnBase64='';if(input[0].files&&input[0].files[0]){var reader=new FileReader();reader.onload=function(e){returnBase64=e.target.result;}
reader.readAsDataURL(input[0].files[0]);}
return returnBase64;}
function srcImage(dbData,elem){var defaultImage=baseUrl+"assets/img/lawyer.png";if(!dbData){return defaultImage}
var imagePath=baseUrl+'/'+dbData;var http=new XMLHttpRequest();http.open('HEAD',imagePath,false);http.send();if(http.status!=404){return imagePath;}else{return defaultImage;}}
function saveQuestionnaire(userID,listingID){var FormDataToSent={};var QuestionElements=$('#form-questions').find('fieldset.questions');var QuestionAnwsersToSent={};$.each(QuestionElements,function(index,el){var QuestionID=$(el).attr('data-question-id');var QuestionType=$(el).attr('data-question-type');var SelectedID;var Answer='';switch(QuestionType){case'radios':var AnwserSelected=$(el).find('input[type="radio"]:checked');Answer=AnwserSelected.val();SelectedID=AnwserSelected.attr('id');break;case'textBoxes':var AnwserSelected=$(el).find('input[type="text"]');Answer=AnwserSelected.val();SelectedID=AnwserSelected.attr('id');break;case'CheckBoxes':var allCheckBoxes=$(el).find('input[type="checkbox"]');var CheckBoxAnswers={};var CheckBoxSelectedIDs={};var countIndex=0;$.each(allCheckBoxes,function(index,el){if($(el).is(':checked')){var CheckBoxJson={};var checkboxID=$(el).attr('id');var checkboxvalue=$(el).attr('value');CheckBoxJson['checkBoxID']=checkboxID;CheckBoxJson['checkBoxValue']=checkboxvalue;CheckBoxAnswers[countIndex]=CheckBoxJson;CheckBoxSelectedIDs[countIndex]=checkboxID;countIndex++;}});if($.isEmptyObject(CheckBoxAnswers)){CheckBoxAnswers=null;}
Answer=CheckBoxAnswers;SelectedID=CheckBoxSelectedIDs;break;case'SelectBox':var AnwserSelected=$(el).find('select')
Answer=AnwserSelected.val();SelectedID=AnwserSelected.attr('id');break;}
var QuestionAnwsers={};if(SelectedID!=undefined){if($.isEmptyObject(SelectedID)){}else{var SubQuestionAnwsersToSave=getSubQuestionAnswers(SelectedID);if($.isEmptyObject(SubQuestionAnwsersToSave)==false){QuestionAnwsers['SubQuestionAnswer']=SubQuestionAnwsersToSave;}}}
if(Answer===undefined||Answer===null||Answer===''){}else{QuestionAnwsers['QuestionID']=QuestionID;QuestionAnwsers['QuestionType']=QuestionType;QuestionAnwsers['QuestionAnswer']=Answer;QuestionAnwsers['QuestionAnswerSelectedID']=SelectedID;QuestionAnwsersToSent[QuestionID]=QuestionAnwsers;}});if($.isEmptyObject(QuestionAnwsersToSent)==false){FormDataToSent['QuestionAnwsers']=QuestionAnwsersToSent;}else{Haider.notification('No Questions Has Been Answered','error');return null;}
if(userID==null||userID==undefined||userID==''){Haider.notification('No User','error');return null;}
if(listingID==null||listingID==undefined||listingID==''){Haider.notification('No Listing','error');return null;}
FormDataToSent['userID']=userID;FormDataToSent['listingID']=listingID;$.ajax({url:base_url+ControllerName+'/QuestionAnwsers/Save',type:'POST',data:FormDataToSent,success:function(output){var data=output.trim().split('::');if(data[0].split(' ').join('')==='OK'){$('.steps').slideUp('slow');$('.steps-layout a').removeClass('active');$('#step-cho').addClass('active');$('#step-choose').slideDown('slow');$('#getPageBuilder').addClass('active');$('.check-your-email').css('color','red');Haider.notification(data[1],data[2]);}else if(data[0].split(' ').join('')==='FAIL'){Haider.notification(data[1],data[2]);}}});}
function getSubQuestionAnswers(SelectedID){var SubQuestionAnwsersToMake={};if($.isEmptyObject(SelectedID)){return null;}
if(SelectedID.isArray||$.isPlainObject(SelectedID)){var countIndex=0;$.each(SelectedID,function(index,el){var subAnswerObject=makeSubQuestionArray(el);if(subAnswerObject!=null){SubQuestionAnwsersToMake[countIndex]=subAnswerObject;}
countIndex++;});}else{var subAnswerObject=makeSubQuestionArray(SelectedID);if(subAnswerObject!=null){SubQuestionAnwsersToMake=subAnswerObject;}}
if($.isEmptyObject(SubQuestionAnwsersToMake)){return null;}
return SubQuestionAnwsersToMake;}
function makeSubQuestionArray(SelectedID){var SelectedIDCheckSubQuestion='.'+SelectedID+'_s.subQuestion';if($('#form-questions').find(SelectedIDCheckSubQuestion).length){var SubQuestionElements=$('#form-questions').find(SelectedIDCheckSubQuestion);var SubQuestionAnwsersToSent={};$.each(SubQuestionElements,function(index,el){var SubParentQuestionID=$(el).attr('data-questionid');var SubQuestionType=$(el).attr('data-type');var SubAnswer='';var SubQuestionAnwsers={};switch(SubQuestionType){case'pre-populatedList':SubAnswer=$(el).find('select').val();SubIsMutli=$(el).find('select').attr('multiple');var listTypeID=$(el).attr('data-id');SubQuestionAnwsers['SubIsMutli']=SubIsMutli;SubQuestionAnwsers['listTypeID']=listTypeID;SubQuestionAnwsers['SubParentQuestionID']=SubParentQuestionID;SubQuestionAnwsers['SubAnswer']=SubAnswer;SubQuestionAnwsers['SubQuestionType']=SubQuestionType;SubQuestionAnwsersToSent['pre-populatedList_'+listTypeID]=SubQuestionAnwsers;break;case'subQuestion':var SubQuestionInnerType=$(el).attr('data-subtype');var SubQuestionID=$(el).attr('data-questionid');switch(SubQuestionInnerType){case'radios':SubAnswer=$(el).find('input[type="radio"]:checked').val();break;case'textBoxes':SubAnswer=$(el).find('input[type="text"]').val();break;case'CheckBoxes':var allSubCheckBoxes=$(el).find('input[type="checkbox"]');var CheckBoxSubAnswers={};var countIndex=0;$.each(allSubCheckBoxes,function(index,el){if($(el).is(':checked')){var CheckBoxSubJson={};var checkboxSubID=$(el).attr('id');var checkboxSubValue=$(el).attr('value');CheckBoxSubJson['checkBoxID']=checkboxSubID;CheckBoxSubJson['checkBoxValue']=checkboxSubValue;CheckBoxSubAnswers[countIndex]=CheckBoxSubJson;countIndex++;}});if($.isEmptyObject(CheckBoxSubAnswers)){CheckBoxSubAnswers=null;}
SubAnswer=CheckBoxSubAnswers;break;case'SelectBox':SubAnswer=$(el).find('select').val();break;}
if(SubAnswer===undefined||SubAnswer===null||SubAnswer===''){}else{SubQuestionAnwsers['SubQuestionInnerType']=SubQuestionInnerType;SubQuestionAnwsers['SubQuestionID']=SubQuestionID;SubQuestionAnwsers['SubParentQuestionID']=SubParentQuestionID;SubQuestionAnwsers['SubAnswer']=SubAnswer;SubQuestionAnwsers['SubQuestionType']=SubQuestionType;SubQuestionAnwsersToSent['subQuestion_'+SubQuestionID]=SubQuestionAnwsers;}
break;}});return SubQuestionAnwsersToSent;}
return null;}
function validatedEmail(email){var re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);}
function commonSelect2New(selector,url,minInputLength,placeholder){selector.select2({minimumInputLength:minInputLength,placeholder:placeholder,ajax:{url:url,dataType:"json",delay:250,data:function(params){return{q:params.term,page:params.page,state:$('#address_state option:selected').attr('value')};},processResults:function(data,params){params.page=params.page||1;return{results:$.map(data.items,function(obj){return{id:obj.ID,text:obj.TEXT};}),pagination:{more:(params.page*30)<data.total_count}};},cache:true},templateSelection:formatData,debug:false});}
function formatData(data){if(data.loading)return data.text;var text=data.text.trim().split(' - ');$('#address_town').val(text[1]);return text[0];}
