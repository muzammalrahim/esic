/*! sir-trevor-columns-block 2015-05-14 */
!function(a,b){if("function"==typeof define&&define.amd)define(["sir-trevor-js","jquery"],b);else if("undefined"!=typeof module&&module.exports){var c=require("sir-trevor-js"),d=require("jquery");module.exports=b(c,d)}else"undefined"!=typeof this&&(a.SirTrevor.Blocks.Columns=b(a.SirTrevor,a.jQuery))}("undefined"!=typeof window?window:this,function(a,b){"use strict";return a.Blocks.Columns=a.Block.extend({type:"Columns",title:function(){return i18n.t("blocks:columns:title")||"Columns"},icon_name:"columns",columns_presets:{"columns-6-6":[6,6],"columns-3-9":[3,9],"columns-9-3":[9,3],"columns-4-8":[4,8],"columns-8-4":[8,4],"columns-4-4-4":[4,4,4],"columns-3-6-3":[3,6,3],"columns-3-3-3-3":[3,3,3,3]},controllable:!0,constructor:function(){a.Block.apply(this,arguments)},beforeBlockRender:function(){this.controls={"columns-6-6":this.changeColumnsHandler("columns-6-6"),"columns-4-4-4":this.changeColumnsHandler("columns-4-4-4"),"columns-4-8":this.changeColumnsHandler("columns-4-8"),"columns-8-4":this.changeColumnsHandler("columns-8-4"),"columns-3-3-3-3":this.changeColumnsHandler("columns-3-3-3-3"),"columns-3-9":this.changeColumnsHandler("columns-3-9"),"columns-9-3":this.changeColumnsHandler("columns-9-3"),"columns-3-6-3":this.changeColumnsHandler("columns-3-6-3")}},changeColumnsHandler:function(a){var b=this;return function(){b.changeColumns(a,!1)}},changeColumns:function(a){this.columns_preset!==a&&this.applyColumns(a)},editorHTML:function(){return'<div class="columns-row" id="#{blockID}-columns-row" style="overflow: auto"/>'.replace("#{blockID}",this.blockID)},_setBlockInner:function(){a.Block.prototype._setBlockInner.apply(this,arguments),this.applyColumns("columns-6-6",!0)},applyColumns:function(c,d){var e=this,f=this.columns_presets[c],g=this.getColumns(":gt("+(f.length-1)+")");if(g.length>0){if(g.children(".st-block").length>0){var h=1===g.length?"column":g.length+" columns";if(!window.confirm("This action will delete last "+h+". Do you really want to proceed?"))return}g.each(function(){var a=b(this);a.children(".st-block").each(function(){e.editorInstance.block_manager.removeBlock(this.getAttribute("id"))}),a.trigger("destroy").remove()})}var i=f.reduce(function(a,b){return a+b},0),j=this.$(".columns-row");f.forEach(function(c,d){var f=Math.round(1e3*c*100/i)/1e3,g=e.getColumn(d);if(0===g.length){g=b('<div class="column" style="float: left;"></div>');var h=new a.FloatingBlockControls(g,e.instanceID,e.mediator);g.prepend(h.render().$el),j.append(g)}g.css("width",f+"%")}),this.$(".st-block-control-ui-btn").removeClass("active").filter("[data-icon="+c+"]").addClass("active"),this.columns_preset=c,d||this.trigger("block:columns:change")},onBlockRender:function(){this.$(".st-block-control-ui-btn").filter("[data-icon="+this.columns_preset+"]").addClass("active")},getRow:function(){return this.$row?this.$row:(this.$row=this.$("#"+this.blockID+"-columns-row"),this.$row)},getColumns:function(a){return this.getRow().children(a)},getColumn:function(a){return this.getRow().children(":eq("+a+")")},_serializeData:function(){var a=this,c=this.columns_presets[this.columns_preset],d={columns:[],preset:this.columns_preset};return this.getColumns().each(function(e){var f=[];b(this).children(".st-block").each(function(){var b=a.editorInstance.findBlockById(this.getAttribute("id"));f.push(b.getData())}),d.columns.push({width:c[e],blocks:f})}),d},loadData:function(a){a.preset&&this.applyColumns(a.preset,!0);for(var b=a.columns||[],c=0;c<b.length;c++)for(var d=null,e=this.getColumn(c),f=0;f<b[c].blocks.length;f++){var g=b[c].blocks[f];d=this.editorInstance.block_manager.createBlock(g.type,g.data,d?d.$el:e.children(".st-block-controls__top"))}},performValidations:function(){}})});